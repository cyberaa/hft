<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>Candidate Structure</title>
    <link rel="stylesheet" type="text/css" href="../style/css/scarce.css"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="generator" content="o-blog version 1.2-144-g8a78ab9"/>

<script src="../style/js/jquery-1.7.1.min.js" type="text/javascript"></script>
<script src="../style/bootstrap/js/bootstrap-modal.js" type="text/javascript"></script>
<script src="../style/bootstrap/js/bootstrap-transition.js" type="text/javascript"></script>
<script src="../style/bootstrap/js/bootstrap-dropdown.js" type="text/javascript"></script>
<script src="../style/bootstrap/js/bootstrap-collapse.js" type="text/javascript"></script>
<script src="../style/js/prettify.js" type="text/javascript"></script>
<script src="../style/js/o-blog.linenumber.js" type="text/javascript"></script>
<script src="../style/js/o-blog-fix.js" type="text/javascript"></script>
<script src="../style/js/scarce.js" type="text/javascript"></script>
<script src="../style/js/twitter-bootstrap-hover-dropdown.js" type="text/javascript"></script>



<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-22236293-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

<!-- Le fav and touch icons -->
<link rel="shortcut icon" href="../favicon.ico?v=2">
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../style/ico/apple-touch-icon-144-precomposed.png">
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="../style/ico/apple-touch-icon-114-precomposed.png">
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="../style/ico/apple-touch-icon-72-precomposed.png">
<link rel="apple-touch-icon-precomposed" href="../style/ico/apple-touch-icon-57-precomposed.png">

</head>
<body>

<div class="container">
  <div class="navbar navbar-inverse">
  <div class="navbar-inner">
    <div class="container">
      <a class="btn btn-navbar" data-toggle="collapse" data-hover=".nav-collapse" data-target=".nav-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </a>
      <a class="brand" href="../index.html">hft,</a>
      <div class="nav-collapse collapse">
          <ul class="nav">
   <li>
     <a href="../about.html"><i>icon-user icon-white</i> About</a>
   </li>
   <li>
  <a class="caret-before" href="../blog/latency-research.html">
       <i class="icon-coffee icon-white">
       </i>
       Blog
     </a>
  </li>
   <li class="dropdown">
 <a class="dropdown-toggle caret-after" data-toggle="dropdown" data-hover="dropdown" data-delay="2000">
 </a>
     <ul class="dropdown-menu">


<li><a href="../blog/latency-research.html">Latency Research</a></li><li><a href="../blog/market-feed-selection.html">Market Feed Selection</a></li><li><a href="../blog/candidate-structure.html">Candidate Structure</a></li><li><a href="../blog/welcome-to-hft.html">Welcome to hft,</a></li>
         
  </ul>
  
  </li>
  <li><a href="https://github.com/tonyday567/hft"><i>icon-github icon-white</i> HFT</a>
  
  </li>
  <li><a href="../tags.html"><i>icon-tags icon-white</i> Tags</a>
  
  </li>
  <li><a href="../archives.html"><i>icon-list icon-white</i> Archives</a>
  
  </li>
  <li><a href="../index.xml"><i>icon-rss icon-white</i> RSS</a>
  </li>
  <li><a href="http://scarcecapital.com"><i>icon-home icon-white</i> scarce,</a>
  </li>

  </ul>


      </div>
    </div>
  </div>
</div>

</div>

<div id="page">
  <div class="row">    
    <div class="arrow_nav top">
      <a class="previous skiphover" href="../about.html">
                                    <span class="symbol">
                                    </span>
                                    <span class="label">
                                       older
                                    </span>
                                    <span class="tooltip">
                                      Welcome to HFT!
                                    </span>
                                 </a>
      <div class="sepline"></div>
      <a class="previous skiphover" href="../blog/market-feed-selection.html">
                                    <span class="label">
                                       newer
                                    </span>
                                    <span class="symbol">
                                       >
                                    </span>                                      
                                    <span class="tooltip">
                                      Market Feed Selection
                                    </span>
                                 </a>
    </div>
  </div>
  <div class="row-fluid">
    <div class="span9">
      <article>
        <header class="article-header">
          <h1 class="post-header">Candidate Structure</h1>
          <h3 class="date-header">11 April 2013</h3>
        </header>
        <div class="article-content">
          <p>
hft is in an experimental phase and, as such, there is a need for flexibility
in the top-down design of the system. To achieve this, the overall design is
first being modelled using graphviz.  The current candidate system looks like this:
</p>


<img class="hero-chart" src="../assets/candidate.svg" alt="design" width="100%">

<ul>
<li>blue boxes represent individual components of the system
</li>
<li>other colors represent external systems and data sources
</li>
<li>each edge of the chart represents a messaging sytem requirement
</li>
<li>there are two main one-way message passing routines that probably
  need to be very very fast (blue lines)
</li>
<li>there is one read from database and one write to database (red lines) 
</li>
<li>every component registers to an observer component that records system
  state and dynamics (grey dotted).
</li>
</ul>



<p>
The components have been grouped into several clusters:
</p>
<ul>
<li>market data: representing trade data, order book and news information
  flowing from outside the sytem to a local data node.
</li>
<li>broker data: representing communication with trading mechanisms
</li>
<li>onwire: components that are "in the event stream".  This is motivated by
  the specifications and documentation of the disruptor which argues that a
  single thread "wheel" is the best way to enable fast processing of market
  data into trading orders.
</li>
<li>offwire: this represents algorithms and processing that are not on the
  single-thread process.  The motivation here is to test the hypothesis in
  the disruptor argument.
</li>
</ul>


<p>
There are several ideas that are being tested:
</p>
<ul>
<li>that the entire system should be the subject of search and optimisation,
  rather than componentry.  One example of this is separation of complex
  event definitions from the statistical analysis once events are defined.
</li>
<li>there is a focus on automation and machine learning.  As such there is no
  place for human interaction.  In particular, no visualization is required. 
</li>
<li>messaging between components can be the same general process.  The
  components can also be tested in exactly the same way (such as speed and
  robustness testing)
</li>
</ul>


<p>
And here's the dot code:
</p>



<pre class="src src-dot">digraph G {
        node [label=<span class="org-string">"\N"</span>];
        node [style=filled, color=<span class="org-string">"#1f3950"</span>,fontcolor=<span class="org-string">"#eeeeee"</span>,shape=box]; 
        subgraph cluster_market_data {
                graph [label=<span class="org-string">"market data"</span>, color=<span class="org-string">"#909090"</span>];
                exchange [shape=egg,color=<span class="org-string">"#ff111111"</span>,fontcolor=<span class="org-string">"#101010"</span>,label=<span class="org-string">"exchanges"</span>];
                aggregator [shape=egg,color=<span class="org-string">"#cc11cc22"</span>,fontcolor=<span class="org-string">"#101010"</span>,label=<span class="org-string">"data stream"</span>];
                localport [label=<span class="org-string">"local node"</span>];
                exchange -&gt; aggregator [dir=none];
                aggregator -&gt; localport [dir=both];
        }
        subgraph cluster_offwire {
                graph [label=<span class="org-string">"offwire"</span>,
                        color=<span class="org-string">"#909090"</span>];
                offwirealgo [label=<span class="org-string">"offline algo"</span>];
                observer;
                databases;
                observer -&gt; databases [color=red,label=<span class="org-string">"write"</span>,fontcolor=red];
        }
        subgraph cluster_onwire {
                graph [label=<span class="org-string">"onwire"</span>,
                        color=<span class="org-string">"#909090"</span>];
                node [style=filled];
                disruptor [label=<span class="org-string">"event server"</span>];
                eventalgo [label=<span class="org-string">"algo"</span>];
                controller;
                controller -&gt; eventalgo [color=<span class="org-string">"#aaaaaa"</span>,dir=both]
                disruptor -&gt; listener;
                disruptor -&gt; eventalgo;
                disruptor -&gt; controller;
                controller -&gt; disruptor [color=<span class="org-string">"#0080ff"</span>];
        }
        subgraph cluster_broker {
                graph [label=<span class="org-string">"broker data"</span>,
                        color=<span class="org-string">"#909090"</span>];
                broker [shape=egg,color=<span class="org-string">"#ff111111"</span>,fontcolor=<span class="org-string">"#101010"</span>,label=<span class="org-string">"brokers"</span>];
                brokeraggregator [shape=egg,color=<span class="org-string">"#cc11cc22"</span>,fontcolor=<span class="org-string">"#101010"</span>,label=<span class="org-string">"aggregation"</span>];
                broker -&gt; brokeraggregator [dir=none];
                brokeraggregator -&gt; trader [dir=both];
        }
        localport -&gt; observer [color=<span class="org-string">"#aaaaaa"</span>,style=dotted];
        controller -&gt; localport [color=<span class="org-string">"#aaaaaa"</span>];
        localport -&gt; disruptor [color=<span class="org-string">"#0080ff"</span>];
        listener -&gt; observer [color=<span class="org-string">"#aaaaaa"</span>,style=dotted];
        controller -&gt; observer [color=<span class="org-string">"#aaaaaa"</span>,style=dotted];
        controller -&gt; trader [color=<span class="org-string">"#aaaaaa"</span>,dir=both];
        controller -&gt; offwirealgo [color=<span class="org-string">"#aaaaaa"</span>,dir=both];
        databases -&gt; offwirealgo [color=red,label=<span class="org-string">"read"</span>,fontcolor=red];
        trader -&gt; observer [color=<span class="org-string">"#aaaaaa"</span>,style=dotted];
        eventalgo -&gt; observer [color=<span class="org-string">"#aaaaaa"</span>,style=dotted];
        offwirealgo -&gt; observer [color=<span class="org-string">"#aaaaaa"</span>,style=dotted];
}
</pre>



<div id="outline-container-1" class="outline-3">
<h3 id="sec-1">haskell interaction</h3>
<div class="outline-text-3" id="text-1">


<p>
Via haskell, the dot chart can be the specifications for an actual system as well as a
representation. And via svg technology, the picture can also be modified to
be a reporting front-end in a production environment.
</p>



<pre class="src src-haskell"><span class="org-keyword">module</span> <span class="org-type">ControllerTest</span><span class="org-whitespace-trailing"> </span>
( importDotFile
, importDot
, printGraph
, nodeList
, edgeList
) <span class="org-keyword">where</span>

<span class="org-keyword">import</span> <span class="org-type">Data.GraphViz</span>
<span class="org-keyword">import</span> <span class="org-keyword">qualified</span> <span class="org-type">Data.Text.Lazy</span> <span class="org-keyword">as</span> <span class="org-type">L</span>
<span class="org-keyword">import</span> <span class="org-keyword">qualified</span> <span class="org-type">Data.Text.Lazy.IO</span> <span class="org-keyword">as</span> <span class="org-type">I</span>
<span class="org-keyword">import</span> <span class="org-keyword">qualified</span> <span class="org-type">Data.GraphViz.Types.Generalised</span> <span class="org-keyword">as</span> <span class="org-type">G</span>
<span class="org-keyword">import</span> <span class="org-type">Data.Graph.Inductive.Graph</span>

<span class="org-function-name">importDotFile</span> <span class="org-variable-name">::</span> <span class="org-type">FilePath</span> <span class="org-variable-name">-&gt;</span> <span class="org-type">IO</span> (<span class="org-type">G.DotGraph</span> <span class="org-type">String</span>)
<span class="org-function-name">importDotFile</span> f <span class="org-variable-name">=</span> <span class="org-keyword">do</span>
        dotText <span class="org-variable-name">&lt;-</span> <span class="org-type">I</span><span class="org-variable-name">.</span>readFile f<span class="org-whitespace-trailing"> </span>
        return <span class="org-variable-name">$</span> parseDotGraph dotText

<span class="org-function-name">importDot</span> <span class="org-variable-name">::</span> <span class="org-type">L.Text</span> <span class="org-variable-name">-&gt;</span> <span class="org-type">G.DotGraph</span> <span class="org-type">Node</span>
<span class="org-function-name">importDot</span> s <span class="org-variable-name">=</span> parseDotGraph s

<span class="org-function-name">printGraph</span> <span class="org-variable-name">::</span> <span class="org-type">G.DotGraph</span> <span class="org-type">String</span> <span class="org-variable-name">-&gt;</span> <span class="org-type">IO</span> <span class="org-type">()</span>
<span class="org-function-name">printGraph</span> d <span class="org-variable-name">=</span> <span class="org-keyword">do</span>
        putStrLn <span class="org-variable-name">$</span> <span class="org-type">L</span><span class="org-variable-name">.</span>unpack <span class="org-variable-name">$</span> printDotGraph d
        return<span class="org-type">()</span>

<span class="org-function-name">nodeList</span> <span class="org-variable-name">::</span> <span class="org-type">G.DotGraph</span> <span class="org-type">String</span> <span class="org-variable-name">-&gt;</span> [<span class="org-type">String</span>]
<span class="org-function-name">nodeList</span> g <span class="org-variable-name">=</span> map nodeID <span class="org-variable-name">$</span> graphNodes g

<span class="org-function-name">edgeList</span> <span class="org-variable-name">::</span> <span class="org-type">G.DotGraph</span> <span class="org-type">String</span> <span class="org-variable-name">-&gt;</span> [(<span class="org-type">String</span>,<span class="org-type">String</span>)]
<span class="org-function-name">edgeList</span> g <span class="org-variable-name">=</span>  map (<span class="org-variable-name">\</span>x <span class="org-variable-name">-&gt;</span> (fromNode x, toNode x)) <span class="org-variable-name">$</span> graphEdges g
</pre>


<p>
So, a new picture generates a new system with potentially new components
(nodes) and messaging requirements (edges).
</p>
</div>

</div>

<div id="outline-container-2" class="outline-3">
<h3 id="sec-2">edges</h3>
<div class="outline-text-3" id="text-2">





<pre class="src src-haskell"><span class="org-keyword">import</span> <span class="org-type">ControllerTest</span>
g <span class="org-variable-name">&lt;-</span> importDotFile <span class="org-string">"../candidate.dot"</span>
<span class="org-function-name">edgeList</span> g
</pre>


<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup><col class="left" /><col class="left" />
</colgroup>
<tbody>
<tr><td class="left">exchange</td><td class="left">aggregator</td></tr>
<tr><td class="left">aggregator</td><td class="left">localport</td></tr>
<tr><td class="left">observer</td><td class="left">databases</td></tr>
<tr><td class="left">controller</td><td class="left">eventalgo</td></tr>
<tr><td class="left">disruptor</td><td class="left">listener</td></tr>
<tr><td class="left">disruptor</td><td class="left">eventalgo</td></tr>
<tr><td class="left">disruptor</td><td class="left">controller</td></tr>
<tr><td class="left">controller</td><td class="left">disruptor</td></tr>
<tr><td class="left">broker</td><td class="left">brokeraggregator</td></tr>
<tr><td class="left">brokeraggregator</td><td class="left">trader</td></tr>
<tr><td class="left">localport</td><td class="left">observer</td></tr>
<tr><td class="left">controller</td><td class="left">localport</td></tr>
<tr><td class="left">localport</td><td class="left">disruptor</td></tr>
<tr><td class="left">listener</td><td class="left">observer</td></tr>
<tr><td class="left">controller</td><td class="left">observer</td></tr>
<tr><td class="left">controller</td><td class="left">trader</td></tr>
<tr><td class="left">controller</td><td class="left">offwirealgo</td></tr>
<tr><td class="left">databases</td><td class="left">offwirealgo</td></tr>
<tr><td class="left">trader</td><td class="left">observer</td></tr>
<tr><td class="left">eventalgo</td><td class="left">observer</td></tr>
<tr><td class="left">offwirealgo</td><td class="left">observer</td></tr>
</tbody>
</table>



</div>

</div>

<div id="outline-container-3" class="outline-3">
<h3 id="sec-3">nodes</h3>
<div class="outline-text-3" id="text-3">





<pre class="src src-haskell"><span class="org-keyword">import</span> <span class="org-type">ControllerTest</span>
<span class="org-keyword">import</span> <span class="org-type">Data.List</span>
g <span class="org-variable-name">&lt;-</span> importDotFile <span class="org-string">"../dot/candidate.dot"</span>
<span class="org-function-name">map</span> (<span class="org-variable-name">\</span>x <span class="org-variable-name">-&gt;</span> [x]) <span class="org-variable-name">$</span> nodeList g
</pre>


<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup><col class="left" />
</colgroup>
<tbody>
<tr><td class="left">aggregator</td></tr>
<tr><td class="left">broker</td></tr>
<tr><td class="left">brokeraggregator</td></tr>
<tr><td class="left">controller</td></tr>
<tr><td class="left">databases</td></tr>
<tr><td class="left">disruptor</td></tr>
<tr><td class="left">eventalgo</td></tr>
<tr><td class="left">exchange</td></tr>
<tr><td class="left">listener</td></tr>
<tr><td class="left">localport</td></tr>
<tr><td class="left">observer</td></tr>
<tr><td class="left">offwirealgo</td></tr>
<tr><td class="left">trader</td></tr>
</tbody>
</table>


</div>
</div>

        </div>
      </article>
    </div>  
    <div class ="span3">
      <div id="sidebar">
      <a href="https://twitter.com/share" class="twitter-share-button" data-via="scarcecapital" data-hashtags="design">Tweet</a>
      <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
      <!-- Place this tag where you want the +1 button to render. -->
<div class="g-plusone" data-annotation="bubble" data-size="medium" data-width="300"></div>

<!-- Place this tag after the last +1 button tag. -->
<script type="text/javascript">
  (function() {
    var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    po.src = 'https://apis.google.com/js/plusone.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
  })();
</script>
<div class="get-scarce">
      <p>feeds:   <a href="https://twitter.com/scarcecapital">Twitter</a> | <a href="../index.xml">RSS</a> | <a href="http://eepurl.com/xZDev">Email</a>
      </p>
</div>
    <p>
      Top Posts:
      
    </p>
    <a class="postlink" href="../blog/latency-research.html">Latency Research</a><br><a class="postlink" href="../blog/market-feed-selection.html">Market Feed Selection</a><br><a class="postlink" href="../blog/candidate-structure.html">Candidate Structure</a><br><a class="postlink" href="../about.html">Welcome to HFT!</a>
    <p><br>Related Articles:<br></p><a class="postlink" href="../tags/design.html">design</a>
</div>

    </div>
  </div>
  <div class="row-fluid">
      <div class="span9">
<div id="disqus_thread"></div>
<script type="text/javascript">
  /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  var disqus_shortname = 'scarce'; // required: replace example with your forum shortname

  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
</div>
</div>

  <hr>
<div id="footer">
  <div class="copyright" style="text-align: center;">
    Copyright <a href="http://scarcecapital.com">Scarce Capital</a> 2010-2013

<p>Licensed under the Apache License, Version 2.0 (the "License");
you may not use this work except in compliance with the License.
You may obtain a copy of the License in the LICENSE file, or at:</p>

<p><a href="http://www.apache.org/licenses/LICENSE-2.0">http://www.apache.org/licenses/LICENSE-2.0</a></p>

<p>Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.</p>




  </div>  
  <p>
    Powered by
    <a href="http://twitter.github.com/bootstrap/">bootstrap</a>
     via 
    <a href="https://github.com/renard/o-blog">o-blog</a>.
  </p>
</div>

</div>
</body>
</html>
